<!DOCTYPE html><html><head><link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"><link rel="stylesheet" type="text/css" href="/assets/lib/ldui/ldui.min.css"><style type="text/css">html,
body {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
}
</style></head><body><div class="p-4 h-100"><script type="text/javascript" src="/assets/lib/ldui/ldui.min.js"></script><div class="mb-4"><div class="btn btn-outline-dark mr-2" ld="move">move</div><div class="btn btn-outline-dark mr-2" ld="pen">pen</div><div class="btn btn-outline-dark mr-2" ld="anchor">anchor</div></div><svg class="w-100 h-75 border"><path fill="#fff" stroke="#000"></path><g><line stroke="#000"></line><circle fill="#fff" r="3" stroke="#000"></circle></g><g><line stroke="#000"></line><circle fill="#fff" r="3" stroke="#000"></circle></g></svg><script>// Generated by LiveScript 1.3.1
var pts, lc, svg, path, cs, ls, delptr, setptr, joinpts, getloc, setcp, view;
pts = [];
lc = {};
svg = ld$.find('svg', 0);
path = ld$.find('path', 0);
cs = ld$.find('circle');
ls = ld$.find('line');
delptr = function(ptr){
  var i;
  if (!~(i = pts.indexOf(ptr))) {
    return;
  }
  pts.splice(i, 1);
  ptr.circle.parentNode.removeChild(ptr.circle);
  return joinpts();
};
setptr = function(ptr){
  var x, y, circle;
  x = ptr.x, y = ptr.y;
  circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
  circle.setAttribute('cx', x);
  circle.setAttribute('cy', y);
  circle.setAttribute('r', 3);
  circle.setAttribute('fill', '#fff');
  circle.setAttribute('stroke', '#000');
  circle.ptr = ptr;
  ptr.circle = circle;
  return svg.appendChild(circle);
};
joinpts = function(){
  var ret, i$, to$, i, ref$, p1, p2;
  ret = "";
  if (pts.length) {
    ret += "M" + pts[0].x + " " + pts[0].y;
  }
  for (i$ = 1, to$ = pts.length; i$ < to$; ++i$) {
    i = i$;
    ref$ = [pts[i - 1], pts[i]], p1 = ref$[0], p2 = ref$[1];
    if (p2.z) {
      p2 = pts[0];
    }
    ret += "C" + (p1.x + p1.cx[1]) + " " + (p1.y + p1.cy[1]) + " " + (p2.x + p2.cx[0]) + " " + (p2.y + p2.cy[0]) + " " + p2.x + " " + p2.y;
  }
  if (lc.vp) {
    ret += (pts.length ? 'L' : 'M') + "" + lc.vp.x + " " + lc.vp.y;
  }
  return path.setAttribute('d', ret);
};
getloc = function(e){
  var rbox;
  rbox = svg.getBoundingClientRect();
  return {
    x: e.clientX - rbox.left,
    y: e.clientY - rbox.top
  };
};
svg.addEventListener('click', function(e){
  var ref$, x, y, ptr;
  ref$ = getloc(e), x = ref$.x, y = ref$.y;
  if (lc.tool === 'pen') {
    if (pts[0] && Math.pow(pts[0].x - x, 2) + Math.pow(pts[0].y - y, 2) < 9 && e.target.nodeName === 'circle') {
      pts.push({
        z: true
      });
    } else {
      if (!pts.length || !pts[pts.length - 1].z) {
        pts.push(ptr = {
          x: x,
          y: y,
          cx: [0, 0],
          cy: [0, 0]
        });
        setptr(ptr);
      }
    }
    return joinpts();
  } else if (lc.tool === 'anchor') {
    console.log(lc.moved);
    if (!lc.moved) {
      lc.cptr.cx = [0, 0];
      lc.cptr.cy = [0, 0];
      setcp(lc.cptr);
      return joinpts();
    }
  }
});
svg.addEventListener('mouseup', function(e){
  return lc.down = false;
});
setcp = function(ptr){
  var x, y;
  x = ptr.x, y = ptr.y;
  ptr.circle.setAttribute('cx', x);
  ptr.circle.setAttribute('cy', y);
  cs[0].setAttribute('cx', x + ptr.cx[0]);
  cs[0].setAttribute('cy', y + ptr.cy[0]);
  cs[1].setAttribute('cx', x + ptr.cx[1]);
  cs[1].setAttribute('cy', y + ptr.cy[1]);
  ls[0].setAttribute('x1', x + ptr.cx[0]);
  ls[0].setAttribute('y1', y + ptr.cy[0]);
  ls[0].setAttribute('x2', x);
  ls[0].setAttribute('y2', y);
  ls[1].setAttribute('x1', x + ptr.cx[1]);
  ls[1].setAttribute('y1', y + ptr.cy[1]);
  ls[1].setAttribute('x2', x);
  return ls[1].setAttribute('y2', y);
};
svg.addEventListener('mousemove', function(e){
  var ref$, x, y, ptr, dx, dy;
  lc.moved = true;
  ref$ = getloc(e), x = ref$.x, y = ref$.y;
  if (lc.tool === 'anchor' && lc.down) {
    if (lc.cptr) {
      ptr = lc.cptr;
      ref$ = [x - ptr.x, y - ptr.y], dx = ref$[0], dy = ref$[1];
      ptr.cx[0] = -dx;
      ptr.cx[1] = +dx;
      ptr.cy[0] = -dy;
      ptr.cy[1] = +dy;
      setcp(ptr);
      return joinpts();
    }
  } else if (lc.tool === 'pen') {
    lc.vp = {
      x: x,
      y: y
    };
    if (pts[0] && pts[pts.length - 1].z) {
      lc.vp = null;
    }
    return joinpts();
  } else if (lc.tool === 'move' && lc.down) {
    if (lc.cptr) {
      ref$ = lc.cptr;
      ref$.x = x;
      ref$.y = y;
      setcp(lc.cptr);
      return joinpts();
    } else if (lc.shape) {
      return lc.shape.setAttribute('transform', "translate(" + (x - lc.dp.x) + ", " + (y - lc.dp.y) + ")");
    }
  }
});
svg.addEventListener('mousedown', function(e){
  var ref$, x, y;
  lc.down = true;
  lc.moved = false;
  ref$ = getloc(e), x = ref$.x, y = ref$.y;
  lc.dp = {
    x: x,
    y: y
  };
  if (e.target.nodeName === 'circle' && e.target.ptr) {
    if ((ref$ = lc.tool) === 'move' || ref$ === 'anchor') {
      lc.cptr = e.target.ptr;
    }
  } else {
    lc.cptr = null;
  }
  if (e.target.nodeName === 'path' && lc.tool === 'move') {
    return lc.shape = e.target;
  }
});
view = new ldView({
  root: document.body,
  action: {
    click: {
      move: function(){
        return lc.tool = 'move';
      },
      pen: function(){
        return lc.tool = 'pen';
      },
      anchor: function(){
        return lc.tool = 'anchor';
      }
    }
  }
});
document.addEventListener('mouseup', function(){
  return lc.down = false;
});</script></div></body></html>